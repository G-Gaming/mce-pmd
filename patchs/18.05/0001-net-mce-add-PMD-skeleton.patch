From 56ee470b7a6cbb7a851e9861cdc07295251d1c6e Mon Sep 17 00:00:00 2001
From: Wenbo Cao <caowenbo@mucse.com>
Date: Wed, 13 Aug 2025 14:28:05 +0800
Subject: [PATCH] mce driver init and enable build option for mce pmd

Signed-off-by: Wenbo Cao <caowenbo@mucse.com>
---
 config/common_linuxapp  | 2 ++
 drivers/net/Makefile    | 1 +
 drivers/net/meson.build | 2 +-
 mk/rte.app.mk           | 2 ++
 4 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/config/common_linuxapp b/config/common_linuxapp
index 5c68cc0ff4..7bd5f82f7c 100644
--- a/config/common_linuxapp
+++ b/config/common_linuxapp
@@ -40,3 +40,5 @@ CONFIG_RTE_LIBRTE_PMD_DPAA2_EVENTDEV=y
 CONFIG_RTE_LIBRTE_PMD_DPAA2_SEC=y
 CONFIG_RTE_LIBRTE_PMD_DPAA2_CMDIF_RAWDEV=y
 CONFIG_RTE_LIBRTE_PMD_DPAA2_QDMA_RAWDEV=y
+
+CONFIG_RTE_LIBRTE_MCE_PMD=y
diff --git a/drivers/net/Makefile b/drivers/net/Makefile
index 9f9da66517..1a74b0ff82 100644
--- a/drivers/net/Makefile
+++ b/drivers/net/Makefile
@@ -47,6 +47,7 @@ DIRS-$(CONFIG_RTE_LIBRTE_THUNDERX_NICVF_PMD) += thunderx
 DIRS-$(CONFIG_RTE_LIBRTE_VDEV_NETVSC_PMD) += vdev_netvsc
 DIRS-$(CONFIG_RTE_LIBRTE_VIRTIO_PMD) += virtio
 DIRS-$(CONFIG_RTE_LIBRTE_VMXNET3_PMD) += vmxnet3
+DIRS-$(CONFIG_RTE_LIBRTE_MCE_PMD) += mce
 
 ifeq ($(CONFIG_RTE_LIBRTE_KNI),y)
 DIRS-$(CONFIG_RTE_LIBRTE_PMD_KNI) += kni
diff --git a/drivers/net/meson.build b/drivers/net/meson.build
index b7d00a04c8..e41a07f2a6 100644
--- a/drivers/net/meson.build
+++ b/drivers/net/meson.build
@@ -3,7 +3,7 @@
 
 drivers = ['af_packet', 'axgbe', 'bonding', 'dpaa', 'dpaa2',
 	'e1000', 'enic', 'fm10k', 'i40e', 'ixgbe',
-	'mvpp2', 'null', 'octeontx', 'pcap', 'ring',
+	'mvpp2', 'null', 'octeontx', 'pcap', 'ring', 'mce',
 	'sfc', 'thunderx', 'virtio']
 std_deps = ['ethdev', 'kvargs'] # 'ethdev' also pulls in mbuf, net, eal etc
 std_deps += ['bus_pci']         # very many PMDs depend on PCI, so make std
diff --git a/mk/rte.app.mk b/mk/rte.app.mk
index 1e32c83e75..cea0e77135 100644
--- a/mk/rte.app.mk
+++ b/mk/rte.app.mk
@@ -231,6 +231,8 @@ _LDLIBS-$(CONFIG_RTE_LIBRTE_OCTEONTX_PMD) += -lrte_pmd_octeontx
 _LDLIBS-$(CONFIG_RTE_LIBRTE_PMD_OPDL_EVENTDEV) += -lrte_pmd_opdl_event
 endif # CONFIG_RTE_LIBRTE_EVENTDEV
 
+_LDLIBS-$(CONFIG_RTE_LIBRTE_MCE_PMD) += -lrte_pmd_mce
+
 ifeq ($(CONFIG_RTE_LIBRTE_RAWDEV),y)
 _LDLIBS-$(CONFIG_RTE_LIBRTE_PMD_SKELETON_RAWDEV) += -lrte_pmd_skeleton_rawdev
 ifeq ($(CONFIG_RTE_EAL_VFIO)$(CONFIG_RTE_LIBRTE_FSLMC_BUS),yy)
-- 
2.43.0

